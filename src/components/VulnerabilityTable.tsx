// src/components/VulnerabilityTable.tsx
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { Button } from "@/components/ui/button"

interface Vulnerability {
  cve: string
  description: string
  severity: string
  dateDetected: string
}

interface Props {
  data: Vulnerability[]
  setData: React.Dispatch<React.SetStateAction<Vulnerability[]>>
  filter: string
  setFilter: (value: string) => void
}

export function VulnerabilityTable({ data, setData, filter, setFilter }: Props) {
const allVulnerabilities: Vulnerability[] = [
  { cve: "CVE-2023-21768", description: "Windows Kernel Elevation of Privilege Vulnerability", severity: "Alta", dateDetected: "2023-01-12" },
  { cve: "CVE-2024-21338", description: "Windows Hyper-V Remote Code Execution Vulnerability", severity: "Crítica", dateDetected: "2024-02-01" },
  { cve: "CVE-2023-28252", description: "Win32k Elevation of Privilege Vulnerability", severity: "Media", dateDetected: "2023-04-10" },
  { cve: "CVE-2022-41040", description: "Microsoft Exchange Server SSRF Vulnerability", severity: "Crítica", dateDetected: "2022-11-09" },
  { cve: "CVE-2023-23397", description: "Microsoft Outlook Elevation of Privilege Vulnerability", severity: "Alta", dateDetected: "2023-03-15" },
  { cve: "CVE-2023-23392", description: "Windows Ancillary Function Driver for WinSock", severity: "Media", dateDetected: "2023-02-20" },
  { cve: "CVE-2023-24880", description: "SmartScreen Security Feature Bypass Vulnerability", severity: "Baja", dateDetected: "2023-05-05" },
  { cve: "CVE-2023-21554", description: "Windows Message Queuing Remote Code Execution", severity: "Crítica", dateDetected: "2023-01-30" },
  { cve: "CVE-2023-21674", description: "Win32k Elevation of Privilege", severity: "Alta", dateDetected: "2023-01-10" },
  { cve: "CVE-2023-28231", description: "RPC Runtime Remote Code Execution", severity: "Crítica", dateDetected: "2023-04-15" },
  { cve: "CVE-2023-29336", description: "Win32k Elevation of Privilege", severity: "Alta", dateDetected: "2023-05-01" },
  { cve: "CVE-2023-29325", description: "Outlook Remote Code Execution", severity: "Media", dateDetected: "2023-06-03" },
  { cve: "CVE-2023-32019", description: "Win32k Graphics Remote Code Execution", severity: "Crítica", dateDetected: "2023-06-20" },
  { cve: "CVE-2023-33131", description: "Windows Kernel Elevation of Privilege", severity: "Alta", dateDetected: "2023-07-04" },
  { cve: "CVE-2023-35385", description: "Windows Error Reporting Privilege Escalation", severity: "Media", dateDetected: "2023-08-11" },
  { cve: "CVE-2023-41763", description: "Microsoft Streaming Service DOS", severity: "Baja", dateDetected: "2023-08-30" },
  { cve: "CVE-2023-35945", description: "Windows Installer Arbitrary File Delete", severity: "Alta", dateDetected: "2023-09-12" },
  { cve: "CVE-2023-38147", description: "Secure Boot Bypass", severity: "Crítica", dateDetected: "2023-09-25" },
  { cve: "CVE-2023-36874", description: "LSASS Elevation of Privilege", severity: "Alta", dateDetected: "2023-10-02" },
  { cve: "CVE-2023-38146", description: "Windows GDI Elevation of Privilege", severity: "Media", dateDetected: "2023-10-15" },
  { cve: "CVE-2023-40998", description: "Edge Information Disclosure", severity: "Baja", dateDetected: "2023-11-01" },
  { cve: "CVE-2023-36019", description: "Windows Kerberos Elevation of Privilege", severity: "Alta", dateDetected: "2023-11-22" },
  { cve: "CVE-2023-36033", description: "Windows Common Log File System Elevation", severity: "Crítica", dateDetected: "2023-12-05" },
  { cve: "CVE-2023-36010", description: "Microsoft Print Spooler Elevation", severity: "Media", dateDetected: "2023-12-18" },
  { cve: "CVE-2024-12345", description: "Windows Shell Elevation via Shortcut", severity: "Alta", dateDetected: "2024-01-04" }
]


  const remaining = allVulnerabilities.filter(v => !data.some(existing => existing.cve === v.cve))
  const noMoreToAdd = remaining.length === 0

  function addRandomVulnerability() {
    if (noMoreToAdd) return
    const random = remaining[Math.floor(Math.random() * remaining.length)]
    setData([...data, random])
  }

  return (
    <div className="space-y-4 p-4 pb-0">
      <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
        <h2 className="text-xl font-semibold">Tabla de Vulnerabilidades</h2>
        <div className="flex gap-2">
          <Select onValueChange={setFilter} value={filter}>
            <SelectTrigger className="w-[200px]">
              <SelectValue placeholder="Filtrar por severidad" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="Todos">Todos</SelectItem>
              <SelectItem value="Crítica">Crítica</SelectItem>
              <SelectItem value="Alta">Alta</SelectItem>
              <SelectItem value="Media">Media</SelectItem>
              <SelectItem value="Baja">Baja</SelectItem>
            </SelectContent>
          </Select>
          <Button onClick={addRandomVulnerability} disabled={noMoreToAdd}>
            Añadir vulnerabilidad
          </Button>
        </div>
      </div>
      <Table>
        <TableHeader>
          <TableRow>
            <TableHead>CVE</TableHead>
            <TableHead>Descripción</TableHead>
            <TableHead>Severidad</TableHead>
            <TableHead>Fecha Deteccion</TableHead>
          </TableRow>
        </TableHeader>
        <TableBody>
          {data.map((vuln) => (
            <TableRow key={vuln.cve}>
              <TableCell>
                <a
                  href={`https://nvd.nist.gov/vuln/detail/${vuln.cve}`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="text-blue-600 hover:underline"
                >
                  {vuln.cve}
                </a>
              </TableCell>
              <TableCell>{vuln.description}</TableCell>
              <TableCell>
  <span
    className={`px-2 py-1 rounded text-xs font-semibold ${
      vuln.severity === "Crítica" ? "bg-red-600 text-white" :
      vuln.severity === "Alta" ? "bg-orange-500 text-white" :
      vuln.severity === "Media" ? "bg-yellow-400 text-black" :
      vuln.severity === "Baja" ? "bg-green-500 text-white" :
      "bg-gray-500 text-white"
    }`}
  >
    {vuln.severity}
  </span>
</TableCell>
              <TableCell>{vuln.dateDetected || "-"}</TableCell>
            </TableRow>
          ))}
        </TableBody>
      </Table>
    </div>
  )
}